%%%%%%%%%%%%%%%%%%%%%%%%%% Speed controller
module SpeedFSM:

%interface declarations
input sQuickAccel, sQuickDecel,sSet;
input sCruisetState: float;
 
output pCruiseSpeed: string; % may need to use an int instead
% 1-CruiseOff
% 2-CruiseOn
% 3 CruiseDisable
% 4 CruiseStndby


constant PedalsMin : float;
function regulateThrottle(integer, float, float) : float;

% in c boolean is an integer but we make it boolean here?%
function isAccel(float, float): boolean; 
function isBrake(float, float): integer;
function floatCal(float): float;

loop
	present pCruiseOn then
		
		if isAccel(?pAccel, PedalsMin) then
			emit pCruiseSpeed(?pAccel);
		end if;
		
		
		%emit A;
		%emit C(floatCal(PedalsMin));

		%emit pCruiseSpeed(saturateThrottle(40.00));

		% something wrong with the way I have done regulate throttle idk what it is tho
		% emit throttle(regulateThrottle(1, 5.0, 10.0));
	end present;
	
	pause;
end loop

end module

%%%%%%%%%%%%%%%%%%%%%%%%%% Speed controller
module SpeedFSM:

%interface declarations
input pCruiseOn;
input pAccel: float;
output throttle: float;
output A;
output B: integer;
output C: float;
output pCruiseSpeed: float;

constant PedalsMin : float;
function regulateThrottle(integer, float, float) : float;

% in c boolean is an integer but we make it boolean here?%
function isAccel(float, float): boolean; 
function isBrake(float, float): integer;
function floatCal(float): float;

loop
	present pCruiseOn then
		
		if isAccel(?pAccel, PedalsMin) then
			emit pCruiseSpeed(?pAccel);
		end if;
		
		
		%emit A;
		%emit C(floatCal(PedalsMin));

		%emit pCruiseSpeed(saturateThrottle(40.00));

		% something wrong with the way I have done regulate throttle idk what it is tho
		% emit throttle(regulateThrottle(1, 5.0, 10.0));
	end present;
	
	pause;
end loop

end module

%%%%%%%%%%%%%%%%%%%%%%%%%% Pedals controller NEEDS TO BE DEVELOPED INTO THROTTLE CONTROL BUT PID WONT WORK!!!
% just tells us if we are accelerating/braking
% we are allowed to assume that brake and accel will not be pressed at the same time
module PedalFSM:

%interface declarations
input pAccel: float;
input pBrake: float;
output AccelOn;
output BrakeOn;

constant PedalsMin : float;

% to connect a boolean in esterel to c, make it an int in C. In C use integer but we make it boolean here%
function isAccel(float, float): boolean; 
function isBrake(float, float): boolean;

loop
	if isAccel(?pAccel, PedalsMin) then
		emit AccelOn;
	end if;

	if isBrake(?pBrake, PedalsMin) then
		emit BrakeOn;
	end if;
	
	pause;
end loop

end module
